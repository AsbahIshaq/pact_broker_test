<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: PactBroker::Pacts::PactsForVerificationRepository
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "PactBroker::Pacts::PactsForVerificationRepository";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../PactBroker.html" title="PactBroker (module)">PactBroker</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Pacts.html" title="PactBroker::Pacts (module)">Pacts</a></span></span>
     &raquo; 
    <span class="title">PactsForVerificationRepository</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: PactBroker::Pacts::PactsForVerificationRepository
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">PactBroker::Pacts::PactsForVerificationRepository</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../Logging.html" title="PactBroker::Logging (module)">Logging</a></span>, <span class='object_link'><a href="../Repositories.html" title="PactBroker::Repositories (module)">Repositories</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html" title="PactBroker::Repositories::Helpers (module)">Repositories::Helpers</a></span>, <span class='object_link'><a href="../Repositories/Scopes.html" title="PactBroker::Repositories::Scopes (module)">Repositories::Scopes</a></span>, <span class='object_link'><a href="../Services.html" title="PactBroker::Services (module)">Services</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/pact_broker/pacts/pacts_for_verification_repository.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="PUBLICATION_ASSOCIATIONS_FOR_EAGER_LOAD-constant" class="">PUBLICATION_ASSOCIATIONS_FOR_EAGER_LOAD =
          
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='symbol'>:provider</span><span class='comma'>,</span>
  <span class='symbol'>:consumer</span><span class='comma'>,</span>
  <span class='symbol'>:consumer_version</span><span class='comma'>,</span>
  <span class='label'>pact_version:</span> <span class='symbol'>:latest_verification</span>
<span class='rbracket'>]</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../Services.html" title="PactBroker::Services (module)">Services</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Services.html#FACTORIES-constant" title="PactBroker::Services::FACTORIES (constant)">Services::FACTORIES</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find-instance_method" title="#find (instance method)">#<strong>find</strong>(provider_name, consumer_version_selectors)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_wip-instance_method" title="#find_wip (instance method)">#<strong>find_wip</strong>(provider_name, provider_version_branch, provider_tags_names, specified_pact_version_shas, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>To find the work in progress pacts for this verification execution: For each provider tag that will be applied to this verification result (usually there will just be one, but we have to allow for multiple tags), find the head pacts (the pacts that are the latest for their tag) that have been successfully verified against the provider tag.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Repositories/Scopes.html" title="PactBroker::Repositories::Scopes (module)">Repositories::Scopes</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Repositories/Scopes.html#scope_for-instance_method" title="PactBroker::Repositories::Scopes#scope_for (method)">#scope_for</a></span>, <span class='object_link'><a href="../Repositories/Scopes.html#unscoped-instance_method" title="PactBroker::Repositories::Scopes#unscoped (method)">#unscoped</a></span>, <span class='object_link'><a href="../Repositories/Scopes.html#with_no_scope-instance_method" title="PactBroker::Repositories::Scopes#with_no_scope (method)">#with_no_scope</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Repositories/Helpers.html" title="PactBroker::Repositories::Helpers (module)">Repositories::Helpers</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Repositories/Helpers.html#all_allowing_lazy_load-instance_method" title="PactBroker::Repositories::Helpers#all_allowing_lazy_load (method)">#all_allowing_lazy_load</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#all_forbidding_lazy_load-instance_method" title="PactBroker::Repositories::Helpers#all_forbidding_lazy_load (method)">#all_forbidding_lazy_load</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#mysql%3F-instance_method" title="PactBroker::Repositories::Helpers#mysql? (method)">#mysql?</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#name_like-instance_method" title="PactBroker::Repositories::Helpers#name_like (method)">#name_like</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#no_columns_selected%3F-instance_method" title="PactBroker::Repositories::Helpers#no_columns_selected? (method)">#no_columns_selected?</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#order_append_ignore_case-instance_method" title="PactBroker::Repositories::Helpers#order_append_ignore_case (method)">#order_append_ignore_case</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#order_ignore_case-instance_method" title="PactBroker::Repositories::Helpers#order_ignore_case (method)">#order_ignore_case</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#pacticipant_id_for_name-instance_method" title="PactBroker::Repositories::Helpers#pacticipant_id_for_name (method)">#pacticipant_id_for_name</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#postgres%3F-instance_method" title="PactBroker::Repositories::Helpers#postgres? (method)">#postgres?</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#select_all_qualified-instance_method" title="PactBroker::Repositories::Helpers#select_all_qualified (method)">#select_all_qualified</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#select_append_all_qualified-instance_method" title="PactBroker::Repositories::Helpers#select_append_all_qualified (method)">#select_append_all_qualified</a></span>, <span class='object_link'><a href="../Repositories/Helpers.html#select_for_subquery-instance_method" title="PactBroker::Repositories::Helpers#select_for_subquery (method)">#select_for_subquery</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Services.html" title="PactBroker::Services (module)">Services</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Services.html#badge_service-instance_method" title="PactBroker::Services#badge_service (method)">#badge_service</a></span>, <span class='object_link'><a href="../Services.html#branch_service-instance_method" title="PactBroker::Services#branch_service (method)">#branch_service</a></span>, <span class='object_link'><a href="../Services.html#certificate_service-instance_method" title="PactBroker::Services#certificate_service (method)">#certificate_service</a></span>, <span class='object_link'><a href="../Services.html#contract_service-instance_method" title="PactBroker::Services#contract_service (method)">#contract_service</a></span>, <span class='object_link'><a href="../Services.html#deployed_version_service-instance_method" title="PactBroker::Services#deployed_version_service (method)">#deployed_version_service</a></span>, <span class='object_link'><a href="../Services.html#environment_service-instance_method" title="PactBroker::Services#environment_service (method)">#environment_service</a></span>, <span class='object_link'><a href="../Services.html#get-instance_method" title="PactBroker::Services#get (method)">#get</a></span>, <span class='object_link'><a href="../Services.html#group_service-instance_method" title="PactBroker::Services#group_service (method)">#group_service</a></span>, <span class='object_link'><a href="../Services.html#index_service-instance_method" title="PactBroker::Services#index_service (method)">#index_service</a></span>, <span class='object_link'><a href="../Services.html#integration_service-instance_method" title="PactBroker::Services#integration_service (method)">#integration_service</a></span>, <span class='object_link'><a href="../Services.html#label_service-instance_method" title="PactBroker::Services#label_service (method)">#label_service</a></span>, <span class='object_link'><a href="../Services.html#matrix_service-instance_method" title="PactBroker::Services#matrix_service (method)">#matrix_service</a></span>, <span class='object_link'><a href="../Services.html#metrics_service-instance_method" title="PactBroker::Services#metrics_service (method)">#metrics_service</a></span>, <span class='object_link'><a href="../Services.html#pact_service-instance_method" title="PactBroker::Services#pact_service (method)">#pact_service</a></span>, <span class='object_link'><a href="../Services.html#pacticipant_service-instance_method" title="PactBroker::Services#pacticipant_service (method)">#pacticipant_service</a></span>, <span class='object_link'><a href="../Services.html#register_default_services-instance_method" title="PactBroker::Services#register_default_services (method)">#register_default_services</a></span>, <span class='object_link'><a href="../Services.html#register_service-instance_method" title="PactBroker::Services#register_service (method)">#register_service</a></span>, <span class='object_link'><a href="../Services.html#released_version_service-instance_method" title="PactBroker::Services#released_version_service (method)">#released_version_service</a></span>, <span class='object_link'><a href="../Services.html#tag_service-instance_method" title="PactBroker::Services#tag_service (method)">#tag_service</a></span>, <span class='object_link'><a href="../Services.html#verification_service-instance_method" title="PactBroker::Services#verification_service (method)">#verification_service</a></span>, <span class='object_link'><a href="../Services.html#version_service-instance_method" title="PactBroker::Services#version_service (method)">#version_service</a></span>, <span class='object_link'><a href="../Services.html#webhook_service-instance_method" title="PactBroker::Services#webhook_service (method)">#webhook_service</a></span>, <span class='object_link'><a href="../Services.html#webhook_trigger_service-instance_method" title="PactBroker::Services#webhook_trigger_service (method)">#webhook_trigger_service</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Repositories.html" title="PactBroker::Repositories (module)">Repositories</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Repositories.html#branch_version_repository-instance_method" title="PactBroker::Repositories#branch_version_repository (method)">#branch_version_repository</a></span>, <span class='object_link'><a href="../Repositories.html#integration_repository-instance_method" title="PactBroker::Repositories#integration_repository (method)">#integration_repository</a></span>, <span class='object_link'><a href="../Repositories.html#label_repository-instance_method" title="PactBroker::Repositories#label_repository (method)">#label_repository</a></span>, <span class='object_link'><a href="../Repositories.html#matrix_repository-instance_method" title="PactBroker::Repositories#matrix_repository (method)">#matrix_repository</a></span>, <span class='object_link'><a href="../Repositories.html#pact_repository-instance_method" title="PactBroker::Repositories#pact_repository (method)">#pact_repository</a></span>, <span class='object_link'><a href="../Repositories.html#pacticipant_repository-instance_method" title="PactBroker::Repositories#pacticipant_repository (method)">#pacticipant_repository</a></span>, <span class='object_link'><a href="../Repositories.html#tag_repository-instance_method" title="PactBroker::Repositories#tag_repository (method)">#tag_repository</a></span>, <span class='object_link'><a href="../Repositories.html#verification_repository-instance_method" title="PactBroker::Repositories#verification_repository (method)">#verification_repository</a></span>, <span class='object_link'><a href="../Repositories.html#version_repository-instance_method" title="PactBroker::Repositories#version_repository (method)">#version_repository</a></span>, <span class='object_link'><a href="../Repositories.html#webhook_repository-instance_method" title="PactBroker::Repositories#webhook_repository (method)">#webhook_repository</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Logging.html" title="PactBroker::Logging (module)">Logging</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Logging.html#included-class_method" title="PactBroker::Logging.included (method)">included</a></span>, <span class='object_link'><a href="../Logging.html#log_error-instance_method" title="PactBroker::Logging#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="../Logging.html#log_with_tag-instance_method" title="PactBroker::Logging#log_with_tag (method)">#log_with_tag</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find-instance_method">
  
    #<strong>find</strong>(provider_name, consumer_version_selectors)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pact_broker/pacts/pacts_for_verification_repository.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_provider_name'>provider_name</span><span class='comma'>,</span> <span class='id identifier rubyid_consumer_version_selectors'>consumer_version_selectors</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_selected_pacts'>selected_pacts</span> <span class='op'>=</span> <span class='id identifier rubyid_find_pacts_by_selector'>find_pacts_by_selector</span><span class='lparen'>(</span><span class='id identifier rubyid_provider_name'>provider_name</span><span class='comma'>,</span> <span class='id identifier rubyid_consumer_version_selectors'>consumer_version_selectors</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_selected_pacts'>selected_pacts</span> <span class='op'>=</span> <span class='id identifier rubyid_selected_pacts'>selected_pacts</span> <span class='op'>+</span> <span class='id identifier rubyid_find_pacts_for_fallback_tags'>find_pacts_for_fallback_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_selected_pacts'>selected_pacts</span><span class='comma'>,</span> <span class='id identifier rubyid_provider_name'>provider_name</span><span class='comma'>,</span> <span class='id identifier rubyid_consumer_version_selectors'>consumer_version_selectors</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_merge_selected_pacts'>merge_selected_pacts</span><span class='lparen'>(</span><span class='id identifier rubyid_selected_pacts'>selected_pacts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_wip-instance_method">
  
    #<strong>find_wip</strong>(provider_name, provider_version_branch, provider_tags_names, specified_pact_version_shas, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>To find the work in progress pacts for this verification execution: For each provider tag that will be applied to this verification result (usually there will just be one, but we have to allow for multiple tags), find the head pacts (the pacts that are the latest for their tag) that have been successfully verified against the provider tag. Then, find all the head pacts, and remove the ones that have been successfully verified by ALL of the provider tags supplied, and the ones that were published before the include_wip_pacts_since date. Then, for all of the head pacts that are remaining (these are the WIP ones) work out which provider tags they are pending for. Don&#39;t include pact publications that were created before the provider tag was first used (that is, before the provider&#39;s git branch was created).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pact_broker/pacts/pacts_for_verification_repository.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_wip'>find_wip</span> <span class='id identifier rubyid_provider_name'>provider_name</span><span class='comma'>,</span> <span class='id identifier rubyid_provider_version_branch'>provider_version_branch</span><span class='comma'>,</span> <span class='id identifier rubyid_provider_tags_names'>provider_tags_names</span><span class='comma'>,</span> <span class='id identifier rubyid_specified_pact_version_shas'>specified_pact_version_shas</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'># TODO not sure about this
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_provider_tags_names'>provider_tags_names</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_provider_version_branch'>provider_version_branch</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_log_debug_for_wip'>log_debug_for_wip</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No provider tags or branch provided. Cannot calculate WIP pacts. Returning an empty list.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_provider_version_branch'>provider_version_branch</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_find_wip_pact_versions_for_provider_by_provider_branch'>find_wip_pact_versions_for_provider_by_provider_branch</span><span class='lparen'>(</span><span class='id identifier rubyid_provider_name'>provider_name</span><span class='comma'>,</span> <span class='id identifier rubyid_provider_version_branch'>provider_version_branch</span><span class='comma'>,</span> <span class='id identifier rubyid_specified_pact_version_shas'>specified_pact_version_shas</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_provider'>provider</span> <span class='op'>=</span> <span class='id identifier rubyid_pacticipant_repository'>pacticipant_repository</span><span class='period'>.</span><span class='id identifier rubyid_find_by_name'>find_by_name</span><span class='lparen'>(</span><span class='id identifier rubyid_provider_name'>provider_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_wip_start_date'>wip_start_date</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:include_wip_pacts_since</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_wip_by_consumer_tags'>wip_by_consumer_tags</span> <span class='op'>=</span> <span class='id identifier rubyid_find_wip_pact_versions_for_provider_by_provider_tags'>find_wip_pact_versions_for_provider_by_provider_tags</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span>
    <span class='id identifier rubyid_provider_tags_names'>provider_tags_names</span><span class='comma'>,</span>
    <span class='id identifier rubyid_wip_start_date'>wip_start_date</span><span class='comma'>,</span>
    <span class='id identifier rubyid_specified_pact_version_shas'>specified_pact_version_shas</span><span class='comma'>,</span>
    <span class='symbol'>:latest_by_consumer_tag</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_wip_by_consumer_branches'>wip_by_consumer_branches</span> <span class='op'>=</span> <span class='id identifier rubyid_find_wip_pact_versions_for_provider_by_provider_tags'>find_wip_pact_versions_for_provider_by_provider_tags</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span>
    <span class='id identifier rubyid_provider_tags_names'>provider_tags_names</span><span class='comma'>,</span>
    <span class='id identifier rubyid_wip_start_date'>wip_start_date</span><span class='comma'>,</span>
    <span class='id identifier rubyid_specified_pact_version_shas'>specified_pact_version_shas</span><span class='comma'>,</span>
    <span class='symbol'>:latest_by_consumer_branch</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_deduplicate_verifiable_pacts'>deduplicate_verifiable_pacts</span><span class='lparen'>(</span><span class='id identifier rubyid_wip_by_consumer_tags'>wip_by_consumer_tags</span> <span class='op'>+</span> <span class='id identifier rubyid_wip_by_consumer_branches'>wip_by_consumer_branches</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Mar 22 17:40:30 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.7.5).
</div>

    </div>
  </body>
</html>